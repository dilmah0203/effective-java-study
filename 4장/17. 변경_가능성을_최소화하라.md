`불변 클래스`는 인스턴스의 내부 값을 수정할 수 없는 클래스입니다. 불변 인스턴스에 간직된 정보는 고정되어 객체가 파괴되는 순간까지 달라지지 않습니다.

## 불변 클래스 5가지 규칙
- 객체의 상태를 변경하는 메소드(변경자)를 제공하지 않습니다.
- 클래스를 확장할 수 없도록 합니다.
	- 상속을 막는 대표적인 방법은 클래스를 final로 선언하는 것입니다.
- 모든 필드를 final로 선언합니다.
- 모든 필드를 private으로 선언합니다.
	- 필드가 참조하는 가변 객체를 클라이언트에서 직접 접근해 수정하는 일을 막아주게 됩니다.
- 자신 외에는 내부의 가변 컴포넌트에 접근할 수 없도록 합니다.
	- 클래스에 가변 객체를 참조하는 필드가 하나라도 있다면 클라이언트에서 그 객체의 참조를 얻을 수 없도록 해야 합니다.


## 불변 객체의 장점
- 불변 객체는 근본적으로 스레드 안전하여 따로 동기화할 필요 없습니다.
- 어떤 스레드도 다른 스레드에 영향을 줄 수 없으니 안심하고 공유할 수 있습니다.
- 한번 만든 인스턴스를 재활용할 수 있습니다.
	- 자주 사용되는 인스턴스를 캐싱하여 같은 인스턴스를 중복 생성하지 않게 해주는 정적 팩터리를 제공할 수 있습니다.
- 자유롭게 공유할 수 있음은 물론, 불변 객체끼리는 내부 데이터를 공유할 수 있습니다.
- 불변 객체는 그 자체로 실패 원자성을 제공합니다.
	- 실패 원자성 : 메서드에서 예외가 발생한 후에도 그 객체는 여전히 유효한 상태를 가집니다.


## 불변 객체의 단점
- 값이 다르면 반드시 독립된 객체로 만들어야 합니다.
	- 원하는 객체를 완성하기까지의 단계가 많고, 그 중간 단계에서 만들어진 객체들이 모두 버려진다면 성능 문제가 더 불거집니다.
	- 이 문제에 대처하는 방법으로, 다단계 연산 속도를 높여주는 가변 동반 클래스를 package-private으로 둡니다.


## 불변 클래스를 만드는 설계 방법
- 상속하지 못하게 하기 위해 `final 클래스`를 선언합니다.
- 모든 생성자를 private 혹은 package-private으로 만들고 public 정적 팩터리를 제공합니다.

```java
// 생성자 대신 정적 팩터리를 사용한 불변 클래스
public class Complex {
    private final double re;
    private final double im;

    private Complex(double re, double im) {
        this.re = re;this.im = im;
    } 

    public static Complex valueOf(doulble re, double im) {
        return new Complex(re, im);
    }
}
```

## 정리
1. Getter가 있다고 해서 무조건 Setter를 만들지 말아야 합니다.
	- 클래스를 꼭 필요한 경우가 아니라면 불변이어야 합니다.
2. 불변으로 만들 수 없는 클래스라도 변경할 수 있는 부분을 최소한으로 줄여야 합니다.
	- 객체가 가질 수 있는 상태의 수를 줄이면 그 객체를 예측하기 쉬워지고 오류가 생길 가능성이 줄어들게 됩니다.
3. 다른 합당한 이유가 없다면 모든 필드는 private final이어야 합니다.
4. 생성자는 불변식 설정이 모두 완료된, 초기화가 완벽히 끝난 상태의 객체를 생성해야 합니다.